import{aE as e,r as t,j as r,d as s,aF as a,aG as n,aH as l,aA as i,aB as o,u as c,aI as d,aJ as u,x as m,B as x}from"./index-DgUKgk1k.js";import{P as h}from"./PreviewModal-DHgUa1PG.js";import{a as g}from"./templates-Deg9zX4d.js";
/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const p=e("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]),b=e("circle-plus",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]]),f=e("copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]),y=e("crown",[["path",{d:"M11.562 3.266a.5.5 0 0 1 .876 0L15.39 8.87a1 1 0 0 0 1.516.294L21.183 5.5a.5.5 0 0 1 .798.519l-2.834 10.246a1 1 0 0 1-.956.734H5.81a1 1 0 0 1-.957-.734L2.02 6.02a.5.5 0 0 1 .798-.519l4.276 3.664a1 1 0 0 0 1.516-.294z",key:"1vdc57"}],["path",{d:"M5 21h14",key:"11awu3"}]]),v=e("download",[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]]),j=e("ellipsis-vertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]),w=e("eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),N=e("lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]),k=e("pen",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]),C=e("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]]);function R({resumeId:e,resumeTitle:s,onRename:a,onDuplicate:n,onDelete:l}){const[i,o]=t.useState(!1),c=t.useRef(null);t.useEffect(()=>{const e=e=>{c.current&&!c.current.contains(e.target)&&o(!1)};return i&&document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[i]);return r.jsxs("div",{className:"relative",ref:c,children:[r.jsx("button",{onClick:e=>{e.stopPropagation(),o(!i)},className:"p-2 text-gray-600 hover:bg-gray-100 rounded-lg transition-colors",title:"More options","aria-label":"More options",children:r.jsx(j,{className:"w-5 h-5"})}),i&&r.jsxs("div",{className:"absolute right-0 top-full mt-1 w-48 bg-white/95 backdrop-blur-xl rounded-lg shadow-xl border border-gray-200 py-1 z-50",children:[r.jsxs("button",{onClick:t=>{t.stopPropagation(),a(e),o(!1)},className:"w-full px-4 py-2 text-left text-sm text-gray-700 hover:bg-gray-50 flex items-center gap-3 transition-colors",children:[r.jsx(k,{className:"w-4 h-4"}),r.jsx("span",{children:"Rename"})]}),r.jsxs("button",{onClick:t=>{t.stopPropagation(),n(e),o(!1)},className:"w-full px-4 py-2 text-left text-sm text-gray-700 hover:bg-gray-50 flex items-center gap-3 transition-colors",children:[r.jsx(f,{className:"w-4 h-4"}),r.jsx("span",{children:"Duplicate"})]}),r.jsx("div",{className:"border-t border-gray-100 my-1"}),r.jsxs("button",{onClick:t=>{t.stopPropagation(),l(e),o(!1)},className:"w-full px-4 py-2 text-left text-sm text-red-600 hover:bg-red-50 flex items-center gap-3 transition-colors",children:[r.jsx(C,{className:"w-4 h-4"}),r.jsx("span",{children:"Delete"})]})]})]})}function D({resume:e,onEdit:s,onDelete:a,onDownload:n,onPreview:l,onDuplicate:i,onRename:o}){const[c,d]=t.useState(!1),[u,m]=t.useState(e.title),[x,h]=t.useState(!1),g=async()=>{const t=u.trim();if(t===e.title||!t)return d(!1),void m(e.title);h(!0);try{await o(e.id,t),d(!1)}catch(r){m(e.title),d(!1)}finally{h(!1)}};return r.jsxs("div",{className:"bg-white rounded-lg shadow-md hover:shadow-xl transition-shadow duration-200 group",children:[r.jsxs("div",{className:"relative bg-gray-100 h-48 overflow-hidden cursor-pointer rounded-t-lg",onClick:()=>l(e.id),children:[r.jsx("img",{src:e.thumbnail_url||(p=e.template_id,{"modern-with-icons":"/docs/templates/modern-with-icons.png","modern-no-icons":"/docs/templates/modern-no-icons.png","classic-alex-rivera":"/docs/templates/alex_rivera.png","classic-jane-doe":"/docs/templates/jane_doe.png"}[p]||"/docs/templates/modern-with-icons.png"),alt:e.title,className:"w-full h-full object-cover object-top"}),r.jsxs("div",{className:"absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity duration-200 flex items-center justify-center gap-2",children:[r.jsx(w,{className:"w-8 h-8 text-white"}),r.jsx("span",{className:"text-white font-medium text-lg",children:"Preview"})]})]}),r.jsxs("div",{className:"p-4",children:[c?r.jsx("input",{type:"text",value:u,onChange:e=>m(e.target.value),onBlur:g,onKeyDown:t=>{"Enter"===t.key&&g(),"Escape"===t.key&&(m(e.title),d(!1))},autoFocus:!0,disabled:x,maxLength:200,className:"font-bold text-xl text-gray-900 w-full bg-white border-2 border-blue-500 rounded px-2 py-1 focus:outline-none disabled:opacity-50 mb-2"}):r.jsx("h3",{className:"font-bold text-xl text-gray-900 truncate mb-2 cursor-text hover:bg-gray-50 rounded px-2 py-1 -mx-2 transition",onClick:e=>{e.stopPropagation(),d(!0)},title:"Click to rename",children:e.title}),r.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[r.jsx("span",{className:"text-xs bg-gray-100 text-gray-600 px-2 py-1 rounded-full",children:(e=>e.split("-").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" "))(e.template_id)}),r.jsxs("span",{className:"text-xs text-gray-500",children:["â€¢ Updated ",(e=>{const t=new Date(e),r=new Date,s=Math.floor((r.getTime()-t.getTime())/1e3);return s<60?"Just now":s<3600?`${Math.floor(s/60)}m ago`:s<86400?`${Math.floor(s/3600)}h ago`:s<604800?`${Math.floor(s/86400)}d ago`:t.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})})(e.updated_at)]})]}),r.jsxs("div",{className:"flex gap-2 items-center",children:[r.jsx("button",{onClick:t=>{t.stopPropagation(),s(e.id)},className:"flex-1 bg-blue-600 text-white py-2 px-4 rounded-lg text-sm font-medium hover:bg-blue-700 transition-colors",children:"Edit Resume"}),r.jsx("button",{onClick:t=>{t.stopPropagation(),n(e.id)},className:"p-2 text-gray-600 hover:bg-gray-100 rounded-lg transition-colors",title:"Download PDF",children:r.jsx(v,{className:"w-5 h-5"})}),r.jsx(R,{resumeId:e.id,resumeTitle:e.title,onRename:()=>d(!0),onDuplicate:i,onDelete:a})]})]})]});var p}function S({isAtLimit:e,resumeCount:t,onCreateNew:s,onUpgrade:a}){return e?t>5?r.jsxs("div",{className:"h-full min-h-[320px] bg-gradient-to-br from-red-50 via-orange-50 to-red-50 border-2 border-red-400 rounded-lg p-6 flex flex-col items-center justify-center",children:[r.jsx("div",{className:"bg-red-100 rounded-full p-4 mb-4",children:r.jsx(p,{className:"w-12 h-12 text-red-600"})}),r.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-2 text-center",children:"Resume Limit Reached"}),r.jsxs("div",{className:"text-2xl font-bold text-red-600 mb-2",children:[t,"/5"]}),r.jsxs("p",{className:"text-sm text-gray-700 mb-4 text-center max-w-xs",children:["You have ",t-5," extra resume",t-5>1?"s":""," from your anonymous session. Please delete ",t-5," resume",t-5>1?"s":""," before creating new ones."]}),r.jsx("p",{className:"text-xs text-gray-500 text-center",children:"Your resumes were preserved when you signed in"})]}):r.jsxs("div",{onClick:a,className:"h-full min-h-[320px] bg-gradient-to-br from-amber-50 via-orange-50 to-amber-50 border-2 border-amber-500 rounded-lg p-6 flex flex-col items-center justify-center cursor-pointer hover:shadow-xl hover:border-amber-600 transition-all duration-200 group",children:[r.jsx("div",{className:"bg-amber-100 rounded-full p-4 mb-4 group-hover:scale-110 transition-transform duration-200",children:r.jsx(y,{className:"w-12 h-12 text-amber-600"})}),r.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-2 text-center",children:"Unlock Unlimited Resumes"}),r.jsx("p",{className:"text-sm text-gray-600 mb-4 text-center",children:"Upgrade to create more than 5 resumes"}),r.jsx("button",{onClick:e=>{e.stopPropagation(),a()},className:"bg-amber-600 hover:bg-amber-700 text-white px-6 py-2 rounded-lg font-medium transition-colors",children:"View Plans"}),r.jsx("p",{className:"text-xs text-gray-500 mt-3",children:"Premium features coming soon"})]}):r.jsxs("div",{onClick:s,className:"h-full min-h-[320px] border-2 border-dashed border-gray-300 rounded-lg p-6 flex flex-col items-center justify-center cursor-pointer hover:border-blue-500 hover:bg-blue-50/20 transition-all duration-200 group",children:[r.jsx(b,{className:"w-16 h-16 text-gray-400 mb-4 group-hover:text-blue-500 group-hover:scale-110 transition-all duration-200"}),r.jsx("h3",{className:"text-lg font-semibold text-gray-700 mb-1 group-hover:text-blue-600 transition-colors",children:"Create New Resume"}),r.jsx("p",{className:"text-sm text-gray-500",children:"Start from a template"})]})}function _({resume:e,isOpen:t,onConfirm:s,onCancel:a,isDeleting:n=!1}){return t&&e?r.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",children:r.jsx("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full mx-4",children:r.jsxs("div",{className:"p-6",children:[r.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[r.jsx("div",{className:"flex-shrink-0",children:r.jsx("svg",{className:"w-12 h-12 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})}),r.jsxs("div",{children:[r.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Delete Resume?"}),r.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"This action cannot be undone"})]})]}),r.jsxs("p",{className:"text-gray-700 mb-6",children:["Are you sure you want to delete ",r.jsx("strong",{className:"text-gray-900",children:e.title}),"? This will permanently remove the resume and all its data."]}),r.jsxs("div",{className:"flex gap-3",children:[r.jsx("button",{onClick:s,disabled:n,className:"flex-1 bg-red-600 hover:bg-red-700 disabled:bg-red-400 text-white font-medium py-2 px-4 rounded-lg transition-colors",children:n?"Deleting...":"Delete"}),r.jsx("button",{onClick:a,disabled:n,className:"flex-1 bg-gray-200 hover:bg-gray-300 disabled:bg-gray-100 text-gray-800 font-medium py-2 px-4 rounded-lg transition-colors",children:"Cancel"})]})]})})}):null}function L({resume:e,isOpen:s,onConfirm:a,onCancel:n,isDuplicating:l=!1}){const[i,o]=t.useState("");if(t.useEffect(()=>{e&&o(`Copy of ${e.title}`)},[e]),!s||!e)return null;return r.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",children:r.jsx("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full mx-4",children:r.jsxs("div",{className:"p-6",children:[r.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[r.jsx("div",{className:"flex-shrink-0",children:r.jsx("svg",{className:"w-12 h-12 text-blue-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})}),r.jsxs("div",{children:[r.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Duplicate Resume"}),r.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Create a copy with a new name"})]})]}),r.jsxs("form",{onSubmit:e=>{e.preventDefault(),i.trim()&&a(i.trim())},children:[r.jsxs("div",{className:"mb-6",children:[r.jsx("label",{htmlFor:"newTitle",className:"block text-sm font-medium text-gray-700 mb-2",children:"New Resume Title"}),r.jsx("input",{type:"text",id:"newTitle",value:i,onChange:e=>o(e.target.value),disabled:l,autoFocus:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 disabled:bg-gray-100 disabled:cursor-not-allowed",placeholder:"Enter new title",maxLength:200}),r.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Original: ",r.jsx("span",{className:"font-medium",children:e.title})]})]}),r.jsxs("div",{className:"flex gap-3",children:[r.jsx("button",{type:"submit",disabled:l||!i.trim(),className:"flex-1 bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 text-white font-medium py-2 px-4 rounded-lg transition-colors",children:l?"Duplicating...":"Duplicate"}),r.jsx("button",{type:"button",onClick:n,disabled:l,className:"flex-1 bg-gray-200 hover:bg-gray-300 disabled:bg-gray-100 text-gray-800 font-medium py-2 px-4 rounded-lg transition-colors",children:"Cancel"})]})]})]})})})}function M({heading:e="Sign In to Access Your Resumes",message:o="Keep your resumes safe in the cloud and access them anywhere",showLocalNote:c=!0}){const{signInWithGoogle:d,signInWithLinkedIn:u,signInWithEmail:m}=s(),[x,h]=t.useState(""),[g,p]=t.useState(!1),[b,f]=t.useState(!1);return r.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 via-blue-50/30 to-purple-50/30 flex items-center justify-center px-4 py-8",children:r.jsx("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full p-8",children:b?r.jsxs("div",{className:"text-center py-8",children:[r.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4",children:r.jsx(l,{className:"text-green-600",size:32})}),r.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Check Your Email"}),r.jsxs("p",{className:"text-gray-600 mb-6",children:["We've sent a magic link to ",r.jsx("strong",{children:x}),".",r.jsx("br",{}),"Click the link in the email to sign in."]}),r.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6",children:r.jsx("p",{className:"text-sm text-blue-800",children:"You'll be signed in automatically when you click the link, and your resumes will be available here."})}),r.jsx("button",{onClick:()=>f(!1),className:"px-6 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors",children:"Try a different method"})]}):r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"flex justify-center mb-6",children:r.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-blue-100 to-purple-100 rounded-full flex items-center justify-center",children:r.jsx(N,{className:"w-10 h-10 text-blue-600"})})}),r.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-gray-900 text-center mb-3",children:e}),r.jsx("p",{className:"text-gray-600 text-center mb-8",children:o}),r.jsxs("div",{className:"space-y-3 mb-6",children:[r.jsxs("button",{onClick:async()=>{try{p(!0),await d()}catch(e){i.error(e.message||"Failed to sign in with Google")}finally{p(!1)}},disabled:g,className:"w-full flex items-center justify-center gap-3 px-4 py-3 border-2 border-gray-200 rounded-lg hover:border-blue-400 hover:bg-blue-50 transition-all disabled:opacity-50 disabled:cursor-not-allowed min-h-[48px]",children:[r.jsx(a,{size:24}),r.jsx("span",{className:"font-semibold text-gray-700",children:"Continue with Google"})]}),r.jsxs("button",{onClick:async()=>{try{p(!0),await u()}catch(e){i.error(e.message||"Failed to sign in with LinkedIn")}finally{p(!1)}},disabled:g,className:"w-full flex items-center justify-center gap-3 px-4 py-3 border-2 border-gray-200 rounded-lg hover:border-blue-400 hover:bg-blue-50 transition-all disabled:opacity-50 disabled:cursor-not-allowed min-h-[48px]",children:[r.jsx(n,{size:24,className:"text-[#0077B5]"}),r.jsx("span",{className:"font-semibold text-gray-700",children:"Continue with LinkedIn"})]})]}),r.jsxs("div",{className:"relative my-6",children:[r.jsx("div",{className:"absolute inset-0 flex items-center",children:r.jsx("div",{className:"w-full border-t border-gray-300"})}),r.jsx("div",{className:"relative flex justify-center text-sm",children:r.jsx("span",{className:"px-2 bg-white text-gray-500",children:"Or use email"})})]}),r.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),x&&/\S+@\S+\.\S+/.test(x))try{p(!0),await m(x),f(!0),i.success("Magic link sent! Check your email to continue.")}catch(t){i.error(t.message||"Failed to send magic link")}finally{p(!1)}else i.error("Please enter a valid email address")},className:"space-y-4 mb-6",children:[r.jsxs("div",{children:[r.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-1",children:"Email Address"}),r.jsxs("div",{className:"relative",children:[r.jsx(l,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",size:20}),r.jsx("input",{type:"email",id:"email",value:x,onChange:e=>h(e.target.value),placeholder:"you@example.com",className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:g})]})]}),r.jsx("button",{type:"submit",disabled:g,className:"w-full bg-gradient-to-r from-blue-600 via-purple-600 to-indigo-700 text-white font-semibold py-3 rounded-lg hover:from-blue-700 hover:via-purple-700 hover:to-indigo-800 transition-all disabled:opacity-50 disabled:cursor-not-allowed min-h-[48px]",children:g?"Sending...":"Send Magic Link"})]}),c&&r.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mt-6",children:r.jsxs("p",{className:"text-xs text-blue-800 text-center",children:[r.jsx("strong",{children:"Note:"})," Your current resume is saved locally on this device"]})})]})})})}const E=[3e4,12e4,6e5];function P(){var e;const a=c(),n=d(),{session:l,loading:p,isAnonymous:b}=s(),{data:f=[],isLoading:y,isError:v,error:j,refetch:w}=u(),[N,k]=t.useState(!1),[C,R]=t.useState(null),[P,I]=t.useState(!1),[F,z]=t.useState(null),[U,T]=t.useState(!1),[$,O]=t.useState(null),[A,B]=t.useState(!1),[H,V]=t.useState(!1),[G,W]=t.useState(null),[Y,J]=t.useState(null),[K,Q]=t.useState(null),[q,X]=t.useState(!1),Z=t.useCallback((e,t,r)=>{var s;n.setQueryData(["resumes",null==(s=null==l?void 0:l.user)?void 0:s.id],s=>(null==s?void 0:s.map(s=>s.id===e?{...s,pdf_generated_at:t,thumbnail_url:r}:s))||[])},[n,null==(e=null==l?void 0:l.user)?void 0:e.id]),{triggerRefresh:ee}=function({onThumbnailUpdated:e}){const[r,s]=t.useState(new Set),a=t.useRef(null),n=t.useRef(null),l=t.useRef(new Map),i=t.useRef(new Map),c=t.useRef(new Map),d=t.useRef(e);t.useEffect(()=>{d.current=e},[e]);const u=t.useRef(e=>{const t=c.current.get(e)||{count:0};if(t.count>=3)return void c.current.delete(e);const r=E[t.count]||E[E.length-1],s=Date.now()+r;c.current.set(e,{count:t.count+1,nextRetryTime:s})}),m=t.useCallback(async e=>{let t=!1;if(s(r=>r.has(e)?r:(t=!0,new Set(r).add(e))),t){l.current.set(e,Date.now());try{const t=await g(e);t.success&&t.pdf_generated_at?(i.current.set(e,t.pdf_generated_at),c.current.delete(e)):t.retryable?(s(t=>{const r=new Set(t);return r.delete(e),r}),l.current.delete(e),u.current(e)):(s(t=>{const r=new Set(t);return r.delete(e),r}),l.current.delete(e),c.current.delete(e))}catch(j){s(t=>{const r=new Set(t);return r.delete(e),r}),l.current.delete(e),u.current(e)}}},[]),x=t.useCallback(async()=>{const e=Date.now();if(!o)return;const{data:{session:t}}=await o.auth.getSession();if(!t)return;let r=[];if(s(e=>(r=Array.from(e),e)),0===r.length)return;const a=r.map(async r=>{const s=l.current.get(r);if(s&&e-s>6e4)return{resumeId:r,timedOut:!0};try{const e=await fetch(`/api/resumes/${r}`,{headers:{Authorization:`Bearer ${t.access_token}`}});if(!e.ok)return{resumeId:r,error:!0};const s=(await e.json()).resume,a=i.current.get(r),n=s.pdf_generated_at;return n&&n!==a?{resumeId:r,updated:!0,pdf_generated_at:n,thumbnail_url:s.thumbnail_url}:{resumeId:r}}catch(j){return{resumeId:r,error:!0}}});(await Promise.allSettled(a)).forEach(e=>{var t;if("fulfilled"===e.status){const{resumeId:r,updated:a,timedOut:n,error:o,pdf_generated_at:m,thumbnail_url:x}=e.value;a?(s(e=>{const t=new Set(e);return t.delete(r),t}),l.current.delete(r),i.current.delete(r),c.current.delete(r),m&&x&&(null==(t=d.current)||t.call(d,r,m,x))):(n||o)&&(s(e=>{const t=new Set(e);return t.delete(r),t}),l.current.delete(r),i.current.delete(r),u.current(r))}})},[]);return t.useEffect(()=>{if(0!==r.size)return a.current||(a.current=setInterval(x,2e3)),()=>{a.current&&(clearInterval(a.current),a.current=null)};a.current&&(clearInterval(a.current),a.current=null)},[r.size]),t.useEffect(()=>(n.current=setInterval(()=>{if(0===c.current.size)return;const e=Date.now();c.current.forEach((t,r)=>{t.nextRetryTime&&e>=t.nextRetryTime&&(c.current.set(r,{...t,nextRetryTime:null}),m(r))})},5e3),()=>{n.current&&clearInterval(n.current)}),[m]),t.useEffect(()=>()=>{a.current&&clearInterval(a.current),n.current&&clearInterval(n.current),l.current.clear(),i.current.clear(),c.current.clear()},[]),{generatingIds:r,triggerRefresh:m}}({onThumbnailUpdated:Z});t.useEffect(()=>{if(!f.length)return;f.filter(e=>{if(!e.pdf_generated_at)return!0;return new Date(e.updated_at)>new Date(e.pdf_generated_at)}).forEach(e=>{ee(e.id)})},[f,ee]),t.useEffect(()=>()=>{G&&window.URL.revokeObjectURL(G)},[G]);const te=e=>{a(`/editor/${e}`)},re=e=>{const t=f.find(t=>t.id===e);t&&(R(t),k(!0))},se=e=>{const t=f.find(t=>t.id===e);t&&(O(t),T(!0))},ae=async(e,t)=>{var r;if(l)try{await m.patch(`/api/resumes/${e}`,{title:t}),n.setQueryData(["resumes",null==(r=null==l?void 0:l.user)?void 0:r.id],r=>(null==r?void 0:r.map(r=>r.id===e?{...r,title:t}:r))||[]),i.success("Resume renamed")}catch(s){throw i.error("Failed to rename resume"),s}},ne=async e=>{var t;if(l)try{z(e);const r=await fetch(`/api/resumes/${e}/pdf`,{method:"POST",headers:{Authorization:`Bearer ${l.access_token}`}});if(!r.ok){const e=await r.json();if(e.missing_icons&&e.missing_icons.length>0)return void i.error(`Cannot generate PDF: Missing ${e.missing_icons.length} icon(s)\n\nMissing: ${e.missing_icons.join(", ")}\n\nPlease edit this resume to upload the missing icons or remove them.`,{duration:8e3});throw new Error(e.error||"Failed to generate PDF")}const s=await r.blob(),a=window.URL.createObjectURL(s),n=document.createElement("a");n.href=a,n.download=`${(null==(t=f.find(t=>t.id===e))?void 0:t.title)||"Resume"}.pdf`,document.body.appendChild(n),n.click(),window.URL.revokeObjectURL(a),document.body.removeChild(n),i.success("Resume downloaded successfully")}catch(r){i.error("Failed to download resume")}finally{z(null)}},le=async e=>{if(l)try{J(e),X(!0),Q(null),V(!0);const t=await fetch(`/api/resumes/${e}/pdf`,{method:"POST",headers:{Authorization:`Bearer ${l.access_token}`}});if(!t.ok){const e=await t.json();if(e.missing_icons&&e.missing_icons.length>0){const t=`Cannot generate PDF: Missing ${e.missing_icons.length} icon(s)\n\nMissing: ${e.missing_icons.join(", ")}\n\nPlease edit this resume to upload the missing icons or remove them.`;return Q(t),void i.error(t,{duration:8e3})}throw new Error(e.error||"Failed to generate PDF")}const r=await t.blob();G&&window.URL.revokeObjectURL(G);const s=window.URL.createObjectURL(r);W(s)}catch(t){const e=t instanceof Error?t.message:"Failed to preview resume";Q(e),i.error(e)}finally{X(!1)}};return p||y?r.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),r.jsx("p",{className:"text-gray-600",children:p?"Initializing authentication...":"Loading your resumes..."}),p&&r.jsx("p",{className:"text-gray-500 text-sm mt-2",children:"If this takes more than 10 seconds, try refreshing the page"})]})}):!p&&b?r.jsx(M,{}):v?r.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:r.jsxs("div",{className:"text-center max-w-md",children:[r.jsx("svg",{className:"w-16 h-16 text-red-500 mx-auto mb-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),r.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Error Loading Resumes"}),r.jsx("p",{className:"text-gray-600 mb-4",children:(null==j?void 0:j.message)||"Failed to load resumes"}),r.jsx("button",{onClick:()=>w(),className:"bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:"Try Again"})]})}):r.jsxs("div",{className:"min-h-screen bg-gray-50",children:[r.jsx("div",{className:"container mx-auto px-4 py-8 max-w-[1200px]",children:r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[r.jsx(S,{isAtLimit:f.length>=5,resumeCount:f.length,onCreateNew:()=>{a("/templates")},onUpgrade:()=>i("Pricing coming soon!")}),f.map(e=>r.jsx(D,{resume:e,onEdit:te,onDelete:re,onDownload:ne,onPreview:le,onDuplicate:se,onRename:ae},e.id))]})}),r.jsx(_,{resume:C,isOpen:N,onConfirm:async()=>{if(C&&l)try{I(!0),await m.delete(`/api/resumes/${C.id}`),i.success("Resume deleted successfully"),w(),k(!1),R(null)}catch(e){i.error("Failed to delete resume")}finally{I(!1)}},onCancel:()=>{k(!1),R(null)},isDeleting:P}),r.jsx(L,{resume:$,isOpen:U,onConfirm:async e=>{var t;if($&&l)try{B(!0),await m.post(`/api/resumes/${$.id}/duplicate`,{new_title:e}),i.success("Resume duplicated successfully"),w(),T(!1),O(null)}catch(r){if(r instanceof x&&"RESUME_LIMIT_REACHED"===(null==(t=r.data)?void 0:t.error_code))return void i.error("You have reached the 5 resume limit. Delete a resume to continue.");i.error("Failed to duplicate resume")}finally{B(!1)}},onCancel:()=>{T(!1),O(null)},isDuplicating:A}),r.jsx(h,{isOpen:H,onClose:()=>{V(!1)},previewUrl:G,isGenerating:q,isStale:!1,error:K,onRefresh:async()=>{Y&&(Q(null),await le(Y))},onDownload:async()=>{Y&&await ne(Y)}}),F&&r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:r.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-sm mx-4",children:[r.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),r.jsx("p",{className:"text-center text-gray-700",children:"Generating PDF..."})]})})]})}export{P as default};
