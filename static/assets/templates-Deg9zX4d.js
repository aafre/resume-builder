import{aB as e}from"./index-DgUKgk1k.js";const t="/api",r=`${t}/templates`;async function o(){const e=await fetch(r);if(!e.ok)throw new Error("Failed to fetch templates");const t=await e.json();if(!t.success||!t.templates)throw new Error("Invalid API response");return t.templates}async function a(e){const r=await fetch(`${t}/template/${e}`);if(!r.ok)throw new Error("Failed to fetch template");const{yaml:o,supportsIcons:a}=await r.json();return{yaml:o,supportsIcons:a}}async function n(e){var r;const o=await fetch(`${t}/generate`,{method:"POST",body:e});if(!o.ok){const e=await o.json();throw new Error(e.error||"Failed to generate resume")}const a=o.headers.get("content-type"),n=o.headers.get("Content-Disposition");if(a&&a.includes("application/pdf")){return{pdfBlob:await o.blob(),fileName:(null==(r=null==n?void 0:n.split("filename=")[1])?void 0:r.replace(/"/g,""))||"resume.pdf"}}{const e=await o.json();throw new Error(e.error||"Unexpected response: Expected a PDF file")}}async function s(e){const r=new AbortController,o=setTimeout(()=>r.abort(),3e4);try{const a=await fetch(`${t}/generate`,{method:"POST",body:e,signal:r.signal});if(clearTimeout(o),!a.ok){let e="Failed to generate preview";try{e=(await a.json()).error||e}catch{}throw new Error(e)}const n=a.headers.get("content-type");if(n&&n.includes("application/pdf"))return await a.blob();{let e="Unexpected response: Expected a PDF file";try{e=(await a.json()).error||e}catch{}throw new Error(e)}}catch(a){if(clearTimeout(o),a instanceof Error&&"AbortError"===a.name)throw new Error("Preview generation timed out. Please try again.");throw a}}async function c(r){try{if(!e)return{success:!1,error:"Supabase not configured",retryable:!1};const{data:{session:o}}=await e.auth.getSession();if(!o)return{success:!1,error:"Not authenticated",retryable:!1};const a=await fetch(`${t}/resumes/${r}/thumbnail`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o.access_token}`}});if(!a.ok){const e=await a.json().catch(()=>({error:"Unknown error",retryable:!1}));return{success:!1,error:e.error||`HTTP ${a.status}`,retryable:e.retryable||!1}}const n=await a.json();return{success:!1!==n.success,thumbnail_url:n.thumbnail_url,pdf_generated_at:n.pdf_generated_at,retryable:n.retryable||!1,error_type:n.error_type}}catch(o){return{success:!1,error:o instanceof Error?o.message:"Unknown error",retryable:!0}}}export{c as a,a as b,n as c,o as f,s as g};
